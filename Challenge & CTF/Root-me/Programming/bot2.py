#!python 
# -*- coding: utf-8 -*-
#BASE64 Encoding/Decoding

import socket
import sys
import string
import re 
import base64

HOST= 'irc.root-me.org'
PORT= 6667

irc = socket.socket()
irc.connect((HOST,PORT))


irc.send('NICK ades\r\n') #use a nick of 4 chars to have a correct split 
irc.send('USER ades ades ades :ades\r\n')
irc.send('JOIN #Root-Me_Challenge\r\n')

while True:
	data = irc.recv ( 4096 )
	if data.find ( 'PING' ) != -1:
		irc.send ( 'PONG' + data.split() [ 1 ] + '\r\n' )
		break

data=""

irc.send('PRIVMSG Candy :!ep2\r\n')
print "Waiting candy's answer"

while True:
	data = irc.recv ( 4096 )
	if data.find ( ':Candy!Candy@hzv-djs.n1p.2olmip.IP PRIVMSG ades :' ) != -1:
		print data
		end = len(data)	
		encoded=""
		for i in range (49,end):
			encoded+=data[i] #encoded now contains the base64 encoded string
		decoded=base64.b64decode(encoded)
		print decoded
		break;

answer = 'PRIVMSG Candy :!ep2 -rep %s \r\n' %decoded
irc.send(answer)	
data=""

while True:
	data = irc.recv ( 4096 )
	print data	

