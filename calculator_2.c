/*

sott = targ - ( (unsigned int)pow(2,32)-(last-targ-1) );

After this sott = last!

*/


#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <string.h>
#include <math.h>
 

int main(int argc , char* argv[])
{
int t;
unsigned int targ , last , diff;
unsigned int sign , sign_temp , sign_old_temp;

unsigned int history[3][4];
char mem[65];

unsigned int hex[4] , flag , flag_3 , first, second , third , tent;

memset(&mem,0,sizeof(mem));
memset(&history,0,sizeof(history));


/*if(argc != 4)
  {
   printf("Usage: <%s> <esp start> <esp end> <path to shellcode>", argv[0]);
  }
*/

targ = strtoul(argv[2],NULL,0); //if 0, the base used is determined by the format of the sequence. 0x = hex 
last = strtoul(argv[3],NULL,0);


diff =( (unsigned int)pow(2,32)-(last-targ-1) ); //now I know how many I have to subtract from target to reach last

hex[3] = ( diff & 0xff000000 ) >> 24;
hex[2] = ( diff & 0x00ff0000 ) >> 16;
hex[1] = ( diff & 0x0000ff00 ) >> 8;
hex[0] = ( diff & 0X000000ff );

int z    = 0;
int c    = 3;
int n    = 0;


do {
      flag   = hex[n];
      if( flag < 0x6f )
         {
          puts("Fatal: can't process a byte < 6f"); // minimum is 0x25 + 0x25 + 0x25 , isn't ammissible!
          exit(0);
         }
      flag_3 = hex[n]/3;
      first  = flag_3;
      second = flag_3;
      third  = flag_3;
 
      tent = first + second + third;
      if( tent > flag )
              {
                third -= ( tent-flag ); //correzione di un addendo
              }
      if( tent < flag )
              {
                third += ( flag - tent );
              }
           
      history[z][c] = first;
      z++;
      history[z][c] = second;
      z++;
      history[z][c] = third ;
      z = 0;
      c--;
      n++;
    }while(n<=3);

int i,j;
for(i=0; i<3; i++)
   { for(j=0; j<4; j++)
        {
         printf("%p", history[i][j]);
        }
     printf(" - \n---------\n");
   }
}
