#!python 
# -*- coding: utf-8 -*-
#ROT13 encoding/decoding

import socket
import sys
import string
import re 
import base64

HOST= 'irc.root-me.org'
PORT= 6667

def decode_rot13(encoded):
	print encoded
	decoded=""
	for c in encoded:
		#print "c is" +c
		value = ord(c)
		value13 = value+13;	
		if(value >= 65 and value <= 90):  #maiuscolo
			if(value13 > 90): #sforato
				value13 = 64+(value13-90)
				decoded+=chr(value13)
			else:
				decoded+=chr(value13)
		elif(value >= 97 and value <= 122): #minuscolo
			if(value13 > 122): #sforato
				value13 = 96+(value13-122)
				decoded+=chr(value13)
			else:
				decoded+=chr(value13)
		#print decoded
	return decoded
	
irc = socket.socket()
irc.connect((HOST,PORT))

irc.send('NICK ares\r\n') #use a nick of 4 chars to have a correct split 
irc.send('USER ares ares ares :ares\r\n')
irc.send('JOIN #Root-Me_Challenge\r\n')

while True:
	data = irc.recv ( 4096 )
	if data.find ( 'PING' ) != -1:
		irc.send ( 'PONG' + data.split() [ 1 ] + '\r\n' )
		break

data=""

irc.send('PRIVMSG Candy :!ep3\r\n')
print "Waiting candy's answer"


while True:
	data = irc.recv ( 4096 )
	if data.find ( ':Candy!Candy@hzv-djs.n1p.2olmip.IP PRIVMSG ares :' ) != -1:
		print data
		end = len(data)	
		encoded=""
		for i in range (49,end):
			encoded+=data[i] #encoded now contains the ROT13 encoded string
		decoded = decode_rot13(encoded)
		break
		
answer = 'PRIVMSG Candy :!ep3 -rep %s \r\n' %decoded
irc.send(answer)	
data=""

while True:
	data = irc.recv ( 4096 )
	print data	
	break
