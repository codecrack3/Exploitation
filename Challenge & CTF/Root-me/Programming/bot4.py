#!python 
# -*- coding: utf-8 -*-
#zlib+base64 encoding-decoding

import socket
import sys
import string
import zlib

HOST= 'irc.root-me.org'
PORT= 6667

irc = socket.socket()
irc.connect((HOST,PORT))

irc.send('NICK ares\r\n') #use a nick of 4 chars to have a correct split 
irc.send('USER ares ares ares :ares\r\n')
irc.send('JOIN #Root-Me_Challenge\r\n')

while True:
	data = irc.recv ( 4096 )
	if data.find ( 'PING' ) != -1:
		irc.send ( 'PONG' + data.split() [ 1 ] + '\r\n' )
		break

data=""

irc.send('PRIVMSG Candy :!ep4\r\n')
print "Waiting candy's answer"


while True:
	data = irc.recv ( 4096 )
	if data.find ( ':Candy!Candy@hzv-djs.n1p.2olmip.IP PRIVMSG ares :' ) != -1:
		print data
		end = len(data)	
		encoded=""
		for i in range (49,end):
			encoded+=data[i] #encoded now contains the base64+zlib encoded string
		decoded = encoded.decode("base64").decode("zlib")
		break
		
answer = 'PRIVMSG Candy :!ep4 -rep %s \r\n' %decoded
irc.send(answer)	
data=""

while True:
	data = irc.recv ( 4096 )
	print data	
	break

