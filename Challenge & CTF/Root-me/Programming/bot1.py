#!python 
# -*- coding: utf-8 -*-
#Simple math answer to irc bot

import socket
import sys
import string
import math
import re 

HOST= 'irc.root-me.org'
PORT= 6667

def to_int(s):
	a=0
	i=0
	s=s[::-1]
	for c in s:
		if(c>='0' and c<='9'):
			a+=int(c)*pow(10,i)
			i+=1
	return a
	
irc = socket.socket()
irc.connect((HOST,PORT))

irc.send('NICK ades\r\n') #use a nick of 4 chars to have a correct split 
irc.send('USER ades ades ades :ades\r\n')
irc.send('JOIN #Root-Me_Challenge\r\n')

while True:
	data = irc.recv ( 4096 )
	if data.find ( 'PING' ) != -1:
		irc.send ( 'PONG' + data.split() [ 1 ] + '\r\n' )
		break

data="";
irc.send('PRIVMSG Candy :!ep1\r\n')

print "Waiting candy's answer"

while True:
	data = irc.recv ( 4096 )
	if data.find ( ':Candy!Candy@hzv-djs.n1p.2olmip.IP PRIVMSG ades :' ) != -1:
		m = re.search(':Candy!Candy@hzv-djs.n1p.2olmip.IP PRIVMSG ades :(.+?)/(.+?)*', data).group()
		end = len(m)
		data=""
		for i in range (49,end):
			data+=m[i] #data now is <num1>/<num2>
		snum1 = data.split('/')[0]
		snum2 = data.split('/')[1]
		n1=to_int(snum1)
		n2=to_int(snum2)	
		res = round(math.sqrt(n1) * n2,2)
		break
		
answer = 'PRIVMSG Candy :!ep1 -rep %0.2f \r\n' %res
irc.send(answer)	
data=""
while True:
	data = irc.recv ( 4096 )
	print data	
